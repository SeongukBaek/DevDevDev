**TOC**
- [자바 8 이후 옵셔널 추가](#자바-8-이후-옵셔널-추가)
- [옵셔널 선택의 기준](#옵셔널-선택의-기준)
- [옵셔널 반환 시 고려 사항](#옵셔널-반환-시-고려-사항)

메소드 반환형
- 예외 : 진짜 예외적인 상황에서만 반환해야 함, 예외 생성 비용이 큼. (예외 생성 시, 스택 추적 전체를 캡처하는 과정이 수반됨)
- null : 메소드 사용처에서 null 처리 코드 추가 필요. 그렇지 않으면 어디서 NPE가 발생될 지 알 수 없음.

# 자바 8 이후 옵셔널 추가
`Optional<T>` : null이 아닌 T 타입 참조를 담거나, 혹은 아무것도 담지 않는 타입
- 최대 1개의 원소를 가질 수 있는 **불변** 컬렉션
- 보통은 T를 반환해야 하지만, 특정 조건에서는 아무것도 반환하지 않아야 할때 사용

> 옵셔널을 반환하는 메소드는 예외를 던지는 메소드보다 유연하고 사용하기 쉽고, null을 반환하는 메소드보다 오류 가능성이 적다.

옵셔널을 반환하는 정적 팩토리
- Optional.empty() : 빈 옵셔널 반환
- Optional.of(value) : value 을 담을 옵셔널 반환

> 스트림의 종단 연산 중 상당수가 옵셔널을 반환한다.

# 옵셔널 선택의 기준
null 반환, 예외 throw 대신 왜 옵셔널을 사용해야 할까?
- 옵셔널은 검사 예외와 취지가 비슷하다. => **반환 값이 없을 수도 있음을 API 사용자에게 명확히 알려준다.**

빈 값을 반환받았을 경우와 실제 값을 반환받았을 경우 모두에 대한 코드를 작성해야 한다.
- 값을 받지 못했을 경우, 기본 값을 설정하는 방법이 있다. (`Optional.orElse()`)
  - 기본 값 설정 비용이 큰 경우, 기본 값이 필요한 경우에만 값을 생성하도록 `orElseGet(Supplier<T>)` 을 사용할 수도 있다.
- 혹은, 상황에 맞는 예외를 던질 수 있다. (`Optional.orElseThrow()`)
  - 해당 메소드는 **예외 팩토리**를 전달받기에, **실제 예외가 발생한 경우에만 생성 비용이 소모**된다!!!
- 또한 `isPresent()` 를 통해 옵셔널의 채워짐 여부를 확인할 수도 있다.
- 추가로 map(): 값이 있다면 인자로 전달받은 Function을 각 요소에 수행 / filter(): 값이 있다면 인자로 전달받은 Function에 해당되는 요소 반환 과 같은 메소드들을 사용할 수 있다.
- 자바 9에서는 `Optional.stream()` 이 추가되어, 값이 있으면 그 값을 원소로 담은 스트림을 반환해주는 기능도 생겼다.

# 옵셔널 반환 시 고려 사항
**컬렉션, 스트림, 배열, 옵셔널 같은 컨테이너 타입은 옵셔널로 반환하면 안된다.**
- 빈 컨테이너 타입을 반환하는 것이 낫다.
- 불필요하게 감싸는 꼴이 된다.

**결과가 없을 수 있으며, 클라이언트가 이 사오항을 특별하게 처리해야 하는 경우 옵셔널을 반환하자.**
- 하지만 위 상황에 해당되더라도, 옵셔널 역시 엄연히 새로 할당하고 초기화해야 하는 객체이고, 값을 꺼내기 위한 메소드 호출이 필요하다.
- 따라서 성능을 중요시하는 경우, 옵셔널이 적합하지 않을 수 있다.

**박싱된 기본 타입을 담는 옵셔널은 기본 타입 자체보다 무겁다.**
- 기본 타입 전용 옵셔널 클래스가 존재한다. (`OptionalInt`, `OptionalLong`, `OptionalDouble`)
- 그러므로 박싱된 기본 타입을 담은 옵셔널을 반환하지 않도록 하자.

**옵셔널을 컬렉션의 키, 값, 원소나 배열의 원소로 사용하는 게 적절한 상황은 거의 없다.**
