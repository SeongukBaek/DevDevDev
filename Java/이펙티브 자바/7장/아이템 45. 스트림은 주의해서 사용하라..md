**TOC**
- []()

# 스트림 등장
스트림 API는 자바 8에서 등장
- 다량의 데이터 처리 작업을 돕기 위함.
- 추상 개념 중 핵심 2가지
  - **스트림** : 데이터 원소의 유한 혹은 무한 시퀀스
  - **스트림 파이프라인** : 이 원소들로 수행하는 연산 단계 표현
  - 스트림 원소 종류 : 컬렉션, 배열, 파일, 정규표현식 패턴 매처, 난수 생성기, 다른 스트림 등
  - 스트림 데이터 원소 : 객체 참조, 기본 타입 값 (int, long, double)

**플루언트 API**
- 스트림 API는 메소드 연쇄를 지원.
- 파이프라인의 모든 호출을 연결해 하나의 표현식으로 완성 가능.
- 또한 파이프라인 여러 개를 연결해 하나의 표현식으로 완성 가능.
 
# 스트림 파이프라인
소스 스트림에서 시작해 종단 연산으로 끝나며, 그 사이에 하나 이상의 중간 연산이 있을 수 있다.
- 각 중간 연산은 스트림을 특정 방식으로 변환.
  - ex. 각 원소에 함수 적용, 원소 필터링
- 변환된 스트림은 기존 스트림의 원소 타입과 같을 수도 있고, 다를 수도 있음.
- 종단 연산은 마지막 중간 연산이 내놓은 스트림에 마지막 연산을 적용.
  - ex. 정렬 후 컬렉션에 담기, 특정 원소 하나 선택, 모든 원소 출력
- 파이프라인은 순차 수행. 병렬도 가능(`parallel()` 호출).
 
## 지연 평가
스트림 파이프라인은 [지연 평가](https://inpa.tistory.com/entry/LODASH-%F0%9F%93%9A-%EC%A7%80%EC%97%B0-%ED%8F%89%EA%B0%80-%EC%9B%90%EB%A6%AC-lodash%EB%8A%94-%EC%98%A4%ED%9E%88%EB%A0%A4-%EC%84%B1%EB%8A%A5%EC%9D%B4-%EC%A2%8B%EC%9D%84-%EC%88%98-%EC%9E%88%EB%8B%A4)(lazy evaluation, 계산이 필요한 시점까지 계산을 미루는 것)된다.
- 종단 연산 호출 시 평가된다.
  - 따라서 종단 연산에 사용되지 않는 데이터 원소는 평가 대상이 아니다.

> 따라서 종단 연산이 없는 파이프라인은 아무 일도 하지 않는 것이다.

> 지연 평가 <-> 엄격한 평가

```java
// 사용자가 지정한 문턱값보다 원소 수가 많은 아나그램 그룹 출력 예시
...
Map<String, Set<String>> groups = new HashMap<>();
try (Scanner s = new Scanner(new File(...))) {
    while (s.hasNext()) {
        String word = s.next();
        groups.computeIfAbsent(alphabetize(word), (unused) -> new TreeSet<>()).add(word);
    }  
}
...
```
- 위 코드는 맵 안에 키가 있는지 찾은 다음, 있으면 단순히 그 키에 매핑된 값을 반환
- 키가 없으면 건네진 함수 객체에 키를 적용해 값을 계산하고, 그 키와 값을 매핑하고 계산된 값 반환

=> `computeIfAbsent()` 를 사용해 각 키에 다수의 값을 매핑하는 맵을 쉽게 구현

> **스트림을 과용하면 프로그램이 읽거나 유지보수하기 어려워진다.** 적절히 활용해 깔끔하고 명료한 코드를 작성하자.
> - 또한, 스트림 내에서의 변수나 람다에서의 매개변수 이름을 잘 지어서, 가독성을 유지하자.

> char 값들을 처리할 때는 스트림을 삼가는 편이 낫다.
